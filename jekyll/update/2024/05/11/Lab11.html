<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Lab11 | Fast Robots 2024 Spring</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Lab11" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Introduction" />
<meta property="og:description" content="Introduction" />
<link rel="canonical" href="http://localhost:4000/FastRobots/jekyll/update/2024/05/11/Lab11.html" />
<meta property="og:url" content="http://localhost:4000/FastRobots/jekyll/update/2024/05/11/Lab11.html" />
<meta property="og:site_name" content="Fast Robots 2024 Spring" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-05-11T00:00:00-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Lab11" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-05-11T00:00:00-04:00","datePublished":"2024-05-11T00:00:00-04:00","description":"Introduction","headline":"Lab11","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/FastRobots/jekyll/update/2024/05/11/Lab11.html"},"url":"http://localhost:4000/FastRobots/jekyll/update/2024/05/11/Lab11.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/FastRobots/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/FastRobots/feed.xml" title="Fast Robots 2024 Spring" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/FastRobots/">Fast Robots 2024 Spring</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/FastRobots/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Lab11</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-05-11T00:00:00-04:00" itemprop="datePublished">May 11, 2024
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="introduction">Introduction</h2>

<p>In this lab I perform localization with the Bayes filter on your actual robot. We only use the update step based on full 360 degree scans with the ToF sensor. The point of the lab is to appreciate the difference between simulation and real-world systems.</p>

<p>The result of this lab is pretty good, which provides a solid foundation to carry on Lab12.</p>

<h2 id="tasks">Tasks</h2>

<h3 id="1-test-localization-in-simulation-run-the-notebook-lab11_simipynb-and-attach-a-single-screenshot-of-the-final-plot-odom-ground-truth-and-belief">1. Test Localization in Simulation: Run the notebook <strong>lab11_sim.ipynb</strong> and attach a single screenshot of the final plot (odom, ground truth and belief).</h3>

<p><img src="/FastRobots/images/Lab11/sim.png" alt="sim" style="zoom:50%;" /></p>

<h3 id="2-using-a-uniform-prior-on-the-pose-run-only-the-update-step-using-the-sensor-measurement-data-to-localize-your-robot">2. Using a uniform prior on the pose, run (only) the update step using the sensor measurement data to localize your robot</h3>

<h4 id="a-implement-member-function-perform_observation_loop-of-class-realrobot">a) Implement member function <strong>perform_observation_loop</strong> of class <strong>RealRobot</strong></h4>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">def</span> <span class="n">perform_observation_loop</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">rot_vel</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span><span class="o">:</span>

    <span class="n">timestamps_ms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">yaws</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">scanning</span> <span class="o">=</span> <span class="n">True</span>
    <span class="n">transfering</span> <span class="o">=</span> <span class="n">True</span>
    
    <span class="n">def</span> <span class="n">notification_handler</span><span class="p">(</span><span class="n">uuid</span><span class="p">,</span> <span class="n">byte_array</span><span class="p">)</span><span class="o">:</span>
        <span class="n">nonlocal</span> <span class="n">scanning</span>
        <span class="n">nonlocal</span> <span class="n">transfering</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="n">ble</span><span class="p">.</span><span class="n">bytearray_to_string</span><span class="p">(</span><span class="n">byte_array</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ss</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="sc">'|'</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">:</span>
            <span class="n">print</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ss</span> <span class="o">==</span> <span class="s">"Scan End"</span><span class="o">:</span>
                <span class="n">scanning</span> <span class="o">=</span> <span class="n">False</span>
            <span class="n">elif</span> <span class="n">ss</span> <span class="o">==</span> <span class="s">"Transfer End"</span><span class="o">:</span>
                <span class="n">transfering</span> <span class="o">=</span> <span class="n">False</span>
            <span class="k">return</span>
            
        <span class="n">idx</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">ss</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="sc">':'</span><span class="p">)</span>
        <span class="n">timestamp</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">yaw</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="sc">'|'</span><span class="p">)</span>
        
        <span class="n">timestamps_ms</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">timestamp</span><span class="p">))</span>
        <span class="n">distances</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">distance</span><span class="p">))</span>
        <span class="n">yaws</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">yaw</span><span class="p">))</span>
    
    <span class="n">observations_count</span> <span class="o">=</span> <span class="mi">18</span>

    <span class="n">self</span><span class="p">.</span><span class="n">ble</span><span class="p">.</span><span class="n">start_notify</span><span class="p">(</span><span class="n">ble</span><span class="p">.</span><span class="n">uuid</span><span class="p">[</span><span class="err">'</span><span class="n">RX_STRING</span><span class="err">'</span><span class="p">],</span> <span class="n">notification_handler</span><span class="p">)</span>
    
    <span class="n">self</span><span class="p">.</span><span class="n">ble</span><span class="p">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">CMD</span><span class="p">.</span><span class="n">START_AUTO</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">scanning</span><span class="o">:</span>
        <span class="n">print</span><span class="p">(</span><span class="s">"scanning"</span><span class="p">)</span>
        <span class="n">asyncio</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">asyncio</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="n">self</span><span class="p">.</span><span class="n">ble</span><span class="p">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">CMD</span><span class="p">.</span><span class="n">GET_HISTORY_DATA</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">transfering</span><span class="o">:</span>
        <span class="n">print</span><span class="p">(</span><span class="s">"transfering"</span><span class="p">)</span>
        <span class="n">asyncio</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">asyncio</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="n">ble</span><span class="p">.</span><span class="n">stop_notify</span><span class="p">(</span><span class="n">ble</span><span class="p">.</span><span class="n">uuid</span><span class="p">[</span><span class="err">'</span><span class="n">RX_STRING</span><span class="err">'</span><span class="p">])</span>
    
    <span class="n">sensor_ranges</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">divide</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">distances</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)[</span><span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">].</span><span class="n">T</span>
    <span class="n">sensor_bearings</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">yaws</span><span class="p">)[</span><span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">].</span><span class="n">T</span>

    <span class="n">print</span><span class="p">(</span><span class="n">sensor_ranges</span><span class="p">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">print</span><span class="p">(</span><span class="n">sensor_bearings</span><span class="p">.</span><span class="n">T</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sensor_ranges</span><span class="p">,</span> <span class="n">sensor_bearings</span>
</code></pre></div></div>

<h4 id="b-place-robot-in-all-four-marked-poses-and-run-the-update-step-of-the-bayes-filter">b) Place robot in all four marked poses and run the update step of the Bayes filter</h4>

<p>I tested all four marked poses:</p>

<ul>
  <li><strong>-3, -2</strong></li>
</ul>

<p><img src="/FastRobots/images/Lab11/-3,-2.png" alt="-3,-2" style="zoom: 40%;" /></p>

<p>This result given by bayes filter is exactly the same as grond truth.</p>

<ul>
  <li><strong>0, 3</strong></li>
</ul>

<p><img src="/FastRobots/images/Lab11/0,3.png" alt="0,3" style="zoom:40%;" /></p>

<p>This result given by bayes filter is exactly the same as grond truth.</p>

<ul>
  <li><strong>5, 3</strong></li>
</ul>

<p><img src="/FastRobots/images/Lab11/5, 3.png" alt="5, 3" style="zoom:40%;" /></p>

<p>This result given by bayes filter is (5, 2), which is one block away from the ground truth (5, 3). But not bad anyway.</p>

<ul>
  <li><strong>5, -3</strong></li>
</ul>

<p><img src="/FastRobots/images/Lab11/5,-3.png" alt="5,-3" style="zoom:40%;" /></p>

<p>This result given by bayes filter is exactly the same as grond truth.</p>

<p>The video of robot working at pose (5, -3) is attached below:</p>

<iframe width="407" height="724" src="https://www.youtube.com/embed/6odRjmYjLyI" title="Fast Robot Lab11" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""></iframe>

<h2 id="discussion">Discussion</h2>

<h3 id="how-close-is-the-localized-pose-wrt-to-the-ground-truth">How close is the localized pose w.r.t to the ground truth?</h3>

<p>In conclusion, 3 of the 4 marked pose give perfect estimation through bayes filter, 1 has an error of one block, which is also good enough.</p>

<h3 id="does-the-robot-localize-better-in-certain-poses-if-so-why">Does the robot localize better in certain poses? If so, why?</h3>

<p>No, it performs almost equally well in all tested poses on my robot.</p>

  </div><a class="u-url" href="/FastRobots/jekyll/update/2024/05/11/Lab11.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/FastRobots/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Fast Robots 2024 Spring</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Fast Robots 2024 Spring</li><li><a class="u-email" href="mailto:dy297@cornell.edu">dy297@cornell.edu</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/yang-d19"><svg class="svg-icon"><use xlink:href="/FastRobots/assets/minima-social-icons.svg#github"></use></svg> <span class="username">yang-d19</span></a></li><li><a href="https://www.linkedin.com/in/ding-yang-829248219"><svg class="svg-icon"><use xlink:href="/FastRobots/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">ding-yang-829248219</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>This website displays the content in the course Fast Robots (Cornell ECE 5160 Spring 2024).</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
